System.register(["jimu-core","jimu-ui","jimu-arcgis","esri/Graphic","esri/core/reactiveUtils","esri/layers/GraphicsLayer","esri/symbols/SimpleFillSymbol"],(function(e,t){var r={},n={},o={},l={},a={},s={},i={};return{setters:[function(e){r.DataRecordSetChangeMessage=e.DataRecordSetChangeMessage,r.DataSourceManager=e.DataSourceManager,r.Immutable=e.Immutable,r.MessageManager=e.MessageManager,r.React=e.React,r.RecordSetChangeType=e.RecordSetChangeType,r.css=e.css,r.getAppStore=e.getAppStore,r.jsx=e.jsx,r.polished=e.polished},function(e){n.Button=e.Button,n.Icon=e.Icon},function(e){o.JimuMapViewComponent=e.JimuMapViewComponent},function(e){l.default=e.default},function(e){a.default=e.default},function(e){s.default=e.default},function(e){i.default=e.default}],execute:function(){e((()=>{var e={5508:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M8 5.5a1 1 0 1 0 0-2 1 1 0 0 0 0 2M6.5 7.5A.5.5 0 0 1 7 7h1.5v4.5h1a.5.5 0 0 1 0 1h-3a.5.5 0 0 1 0-1h1V8H7a.5.5 0 0 1-.5-.5"></path><path fill="#000" fill-rule="evenodd" d="M8 16A8 8 0 1 1 8 0a8 8 0 0 1 0 16m0-1A7 7 0 1 0 8 1a7 7 0 0 0 0 14" clip-rule="evenodd"></path></svg>'},2089:e=>{"use strict";e.exports=l},2243:e=>{"use strict";e.exports=a},9620:e=>{"use strict";e.exports=s},26:e=>{"use strict";e.exports=i},2686:e=>{"use strict";e.exports=o},9244:e=>{"use strict";e.exports=r},4321:e=>{"use strict";e.exports=n}},t={};function c(r){var n=t[r];if(void 0!==n)return n.exports;var o=t[r]={exports:{}};return e[r](o,o.exports,c),o.exports}c.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return c.d(t,{a:t}),t},c.d=(e,t)=>{for(var r in t)c.o(t,r)&&!c.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},c.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),c.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.p="";var u={};return c.p=window.jimuConfig.baseUrl,(()=>{"use strict";c.r(u),c.d(u,{__set_webpack_public_path__:()=>h,default:()=>f});var e=c(9244),t=c(4321),r=c(2686);var n=c(2089),o=c(2243),l=c(9620),a=c(26),s=c(5508),i=c.n(s);const{useEffect:d,useState:p,useRef:g}=e.React,f=s=>{var c;const{config:u,id:f}=s,h=e.React.createRef(),y=e.React.createRef();if(!s.config.layersConfig||0===s.config.layersConfig.length)return(0,e.jsx)("div",null,"Please add a data source");const m=g({}),v=g({}),b=g([]),x=g([]),w=g(null),M=g(0),S=s.config.layersConfig.length,[C,j]=p(),I=e.React.createRef(),R=e.React.createRef(),T=g([]),B=g({}),L=g({}),F=g({}),H=g({}),N=g({}),D=g({}),_=g({}),k=g(new l.default({id:"SearchResult_highlight",title:"Search Result Highlight",listMode:"hide"}));d((()=>{P()}),[u]),e.css`
    & {
      height: ${e.polished.rem(32)};
      margin-top: 1px;
      margin-left: 1px;
    }
    &.search-con-Style3 {
      border-bottom: 1px solid var(--ref-palette-neutral-500);
    }
  `;const P=()=>{E(),V()},A=(e,t)=>7===e.length?[parseInt(e.slice(1,3),16),parseInt(e.slice(3,5),16),parseInt(e.slice(5,7),16),t]:4===e.length?[17*parseInt(e.slice(1,2),16),17*parseInt(e.slice(2,3),16),17*parseInt(e.slice(3,4),16),t]:[0,0,0,.5],E=()=>{if(m.current&&Object.keys(m.current).length>0)return;const t=e.DataSourceManager.getInstance();for(let r=0;r<s.config.layersConfig.length;r++){const n=t.getDataSource(s.config.layersConfig[r].useDataSource.dataSourceId);v.current[s.config.layersConfig[r].id]=n;const o=s.config.layersConfig[r];t.createDataSourceByUseDataSource((0,e.Immutable)(o.useDataSource)).then((e=>{let t;t=(null==e?void 0:e.layer)?Promise.resolve(e.layer):e.createJSAPILayerByDataSource().then((e=>Promise.resolve(e))),t.then((e=>{m.current[o.id]=e})).catch((e=>{console.error(e)}))})).catch((e=>{console.error(e)}))}},O="width: 100%; border-spacing: 10px; padding-top: 5px; border: 1px solid black; border-collapse: collapse; border-left: none; border-right: none;",U="text-align: left; padding: 5px;",V=()=>{let t="";e.css`
        width: 100%;
        border-spacing: 10px;
        border: 1px solid black;
        border-left: none;
        border-right: none;
        border-collapse: collapse;
      `;for(let e=0;e<s.config.layersConfig.length;e++){const r=s.config.layersConfig[e],n=r.searchFields.map((e=>e.alias)).join(", ");t+="<tr><td className='p-8'>"+r.name+"</td><td style='"+U+"'>"+n+"</td></tr>"}t="<B>Layers and Fields to Search</B><br/><br/><table style='"+O+"'><tr style={'"+O+"'><th style='"+U+"'><B>Layer Names</B></th><th style='"+U+"'><B>Fields</B></th></tr>"+t+"</table>",I.current.innerHTML=t},J=e=>{""===e&&(h.current.innerHTML=""),h.current&&h.current.innerHTML.includes(e)||(h.current.innerHTML.length>0&&(h.current.innerHTML+="<br/>"),h.current.innerHTML+=e)},W=()=>{if(C.view.popup){C.view.closePopup();try{C.view.popup.clear()}catch(e){}}J(""),document.getElementById("resultTable_div").innerHTML="",document.getElementById("result_div").style.display="none",b.current=[],w.current=null,M.current=0,R.current.innerHTML="",R.current.style.display="none",L.current={},T.current=null,B.current={};for(const[e,t]of Object.entries(F.current))t.removeAll();if(k.current.removeAll(),x.current.length>0){x.current.forEach((e=>{e.records=[]}));const t=new e.DataRecordSetChangeMessage(f,e.RecordSetChangeType.CreateUpdate,x.current);e.MessageManager.getInstance().publishMessage(t),x.current=[]}},q=()=>{W();const t=y.current.value.trim();if(!t)return void J("Please input search value");(e=>{e=e.replace(/'/g,"''"),B.current={};let t=e.split(",").map((e=>e.trim()));t=t.filter((e=>e.length>0)),T.current=t;for(let e=0;e<s.config.layersConfig.length;e++){const r=s.config.layersConfig[e],n=r.searchFields.map((e=>e.name));let o="";for(let e=0;e<n.length;e++){let r="";for(let o=0;o<t.length;o++){let l="";l=/^\d+$/.test(t[o])?n[e]+" LIKE '%"+t[o]+"%'":s.config.caseSensitive?n[e]+" like '%"+t[o]+"%'":"UPPER("+n[e]+") LIKE UPPER('%"+t[o].toUpperCase()+"%')",r+=r.length>0?" OR ":"",r+=l}o+=o.length>0?" OR ":"",o+="("+r+")"}B.current[r.id]=o}})(t);const r=document.getElementById("resultTable_div"),n=e.DataSourceManager.getInstance(),o=[];for(let e=0;e<s.config.layersConfig.length;e++){const t=s.config.layersConfig[e],r=n.getDataSource(t.useDataSource.dataSourceId),l={where:B.current[t.id],outFields:["*"],returnGeometry:!0};o.push(r.query(l)),v.current[t.id]=r}Promise.all(o).then((e=>{M.current=0;for(let t=0;t<e.length;t++){const n=v.current[s.config.layersConfig[t].id],o=s.config.layersConfig[t],l=e[t];if(M.current++,l.error)return void K(l.error,n,o,r);z(l,n,o,r)}})).catch((e=>{console.error(e),J("Error performing query operation")}))},z=(t,r,o,l)=>{document.getElementById("result_div").style.display="block";const a=t.records,s=a.length,i=t.exceededTransferLimit;if(G(s,i,o,l),a&&0!==a.length){const e={records:a,fields:o.searchFields.map((e=>e.name)),dataSource:r,name:r.id};x.current.push(e);const t=F.current[o.id],l=a.map((e=>(t.add(new n.default({geometry:e.feature.geometry,attributes:e.feature.attributes,symbol:H.current[o.id]})),e.feature)));0===b.current.length?b.current=l:b.current=b.current.concat(l),console.log("Features found in "+o.name,b.current.length),$(o,l,s)}else console.log("No features found",o.name);if(M.current===S){if(x.current.length>0){const t=new e.DataRecordSetChangeMessage(f,e.RecordSetChangeType.CreateUpdate,x.current);e.MessageManager.getInstance().publishMessage(t)}b.current.length>0&&Q()}},G=(e,t,r,n)=>{console.log("Build result table for layer:",r.name);let o="";void 0===n.innerHTML||0===n.innerHTML.length?(o='<table style="'+O+'">',o+='<tr style="'+O+'"><td style="'+U+'">Layer Name</td><td style="'+U+'">Number of Features</td></tr>'):(o=n.innerHTML,o=o.replace("</table>","")),o+='<tr><td style="'+U+'">'+r.name+'</td><td style="'+U+'">'+e+(t?"+":"")+"</td></tr>",o+="</table>",n.innerHTML=o},K=(e,t,r,n)=>{let o="";e.message&&(o=e.message+" "),e.details&&e.details.raw&&e.details.raw.code&&(o+="(error code: "+e.details.raw.code+")"),""===o&&(o="Error performing query operation"),o+=" for layer: "+r.name,J(o),console.info(e),Q()},$=(e,t,r)=>{console.log("checkIfHasSearchValues in layer:",e.name);const n=e.searchFields.map((e=>e.name)),o=n.length,l=T.current.length,a=new Array(l).fill(!1);if(L.current[e.id]=a,r>0)for(let e=0;e<r;e++){const r=t[e];if(a.includes(!1))for(let e=0;e<l;e++)if(1!=a[e]){const t=T.current[e];for(let l=0;l<o;l++){const o=r.attributes[n[l]];if(o)if(s.config.caseSensitive){if(o.includes(t)){a[e]=!0;continue}}else if(o.toUpperCase().includes(t.toUpperCase())){a[e]=!0;continue}}}}},Q=()=>{if(0===b.current.length)return void J("No features found");C.view.popup.features=b.current,(null==w.current||w.current>=b.current.length)&&(w.current=0),C.view.popup.selectedFeatureIndex=w.current;const e=b.current[w.current].geometry;let t;t="point"==e.type?e:e.extent.center,C.view.extent.contains(t)||C.view.goTo(t),C.view.openPopup({features:b.current,selectedFeatureIndex:w.current,location:t,updateLocationEnabled:!0})},X=(e=null)=>{if(0===b.current.length)return;if(e&&e!==b.current[w.current])return void k.current.removeAll();const t=b.current[w.current];k.current.removeAll();const r=new n.default({geometry:t.geometry});"point"===t.geometry.type?r.symbol=_.current:"polyline"===t.geometry.type?r.symbol=D.current:r.symbol=N.current,k.current.add(r)},Y={zIndex:1e3,display:"none",position:"absolute",backgroundColor:"#f9f9f9",padding:"10px",border:"1px solid black",boxShadow:"1px 1px #888888",width:"80%"},Z={overflow:"visible !important",width:"100%"};return(0,e.jsx)("div",{className:"widget-search-plus jimu-widget p-4",style:Z},s.useMapWidgetIds&&1===s.useMapWidgetIds.length&&(0,e.jsx)(r.JimuMapViewComponent,{useMapWidgetId:null===(c=s.useMapWidgetIds)||void 0===c?void 0:c[0],onActiveViewChange:t=>{t&&(j(t),t.view.popup&&(t.view.popup.updateLocationEnabled=!0,o.default.when((()=>t.view.popup.selectedFeature),(e=>{e?(w.current=t.view.popup.selectedFeatureIndex,X(e)):k.current.removeAll()}))),(t=>{var r;for(let e=0;e<s.config.layersConfig.length;e++){const r=s.config.layersConfig[e],n=new l.default({id:"SearchResult_"+r,title:"Search Result for "+r.name});t.view.map.add(n),F.current[r.id]=n;const o=a.default.fromJSON(r.symbol);H.current[r.id]=o}t.view.map.add(k.current);const n=null===(r=s.useMapWidgetIds)||void 0===r?void 0:r[0],o=(0,e.getAppStore)().getState().appConfig.widgets[n].config,i=o.selectionHighlightColor||"#00FFFF",c=o.selectionHighlightHaloColor||"#00FFFF",u=A(i,.3),d=A(c,.95);D.current={type:"simple-line",color:d,width:"3px"},_.current={type:"marker-marker",color:u,outline:{type:"simple-line",color:d,width:"2px"},size:"10px"},N.current={type:"simple-fill",color:u,outline:{type:"simple-line",color:d,width:"3px"}}})(t),t.view.popup&&o.default.watch((()=>t.view.popup.visible),(e=>{e?X():k.current.removeAll()})))}}),(0,e.jsx)("div",null,(0,e.jsx)("div",{style:Z,className:"h-300"},"Search in multiple fields and in multiple layers. Use commas to separate values. ",(0,e.jsx)("span",{style:{cursor:"pointer",textDecoration:"underline"},onMouseOver:e=>{if(void 0!==I.current){const e=I.current.getBoundingClientRect().right;I.current.style.right=e+15+"px",I.current.style.display="block"}},onMouseOut:()=>{void 0!==I.current&&(I.current.style.display="none")}},"More Info"),(0,e.jsx)("div",{style:Y,ref:I})),(0,e.jsx)("input",{className:"w-100 searchInput",placeholder:"Search value",ref:y,onKeyDown:e=>{"Enter"===e.key&&(e.preventDefault(),q())}}),(0,e.jsx)("div",{className:"w-100 p-1 pb-3 text-right"},(0,e.jsx)(t.Button,{type:"primary",onClick:()=>{navigator.clipboard.readText().then((e=>{y.current.value=e})).catch((e=>{console.error("Failed to read clipboard contents: ",e)}))}},"Paste")," ",(0,e.jsx)(t.Button,{type:"primary",onClick:q},"Search")," ",(0,e.jsx)(t.Button,{type:"primary",onClick:()=>{y.current.value="",W()}},"Clear"))),(0,e.jsx)("div",{id:"result_div",style:{display:"none"}},(0,e.jsx)("table",{className:"w-100"},(0,e.jsx)("tr",{className:"align-bottom"},(0,e.jsx)("td",{className:"text-left font-weight-bold"},"Search Result"),(0,e.jsx)("td",{className:"text-right align-middle"},(0,e.jsx)(t.Button,{type:"primary",onClick:Q},"Show Popup")," ",(0,e.jsx)(t.Button,{type:"secondary",className:"border-0 w-24",onMouseOver:e=>{if(0===R.current.innerHTML.length&&T.current.length>0&&(()=>{let e="<B>Match Report</B><br/><br/>",t="",r="";for(let e=0;e<T.current.length;e++){const n=[];for(let t=0;t<s.config.layersConfig.length;t++){const r=s.config.layersConfig[t];r.id in L.current&&1==L.current[r.id][e]&&n.push(r.name)}n.length>0?t+="<tr><td style='"+U+"'>"+T.current[e]+"</td><td style='"+U+"'>"+n.join(", ")+"</td></tr>":r+="<div class='ml-5'>"+T.current[e]+"</div>"}0===t.length?e+="No values are found in any of the layers":(e+="<table style='"+O+"'><tr><th style='"+U+"'>Values</th><th style='"+U+"'>Found in </th></tr>"+t+"</table>",r.length>0&&(e+="<br/><b>Values not found</b><hr/>"+r)),R.current.innerHTML=e})(),R.current.innerHTML.length>0){const e=R.current.getBoundingClientRect().right;R.current.style.right=e+15+"px",R.current.style.display="block"}},onMouseOut:()=>{R.current.style.display="none"}},(0,e.jsx)(t.Icon,{size:24,icon:i()}))))),(0,e.jsx)("div",{style:Y,className:"overflowVisibleStyle",ref:R}),(0,e.jsx)("div",{className:"mt-2",id:"resultTable_div"})),(0,e.jsx)("br",null),(0,e.jsx)("div",{className:"w-100 mt-20 align-bottom"},(0,e.jsx)("p",{className:"mt-20",ref:h})))};function h(e){c.p=e}})(),u})())}}}));